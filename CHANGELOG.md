# Changelog

## v2.0.0 - 2026-02-08 完全重构

### 架构重构
- 将 1468 行 app.py 拆分为模块化架构：core/ + ui/ + configs/
- 审核规则从硬编码改为 JSON 配置驱动（configs/nengen_direction1.json）
- 新增 7 项独立硬性审核检查函数（hard_checks.py）
- 新增一键修复引擎（auto_fix.py）
- 新增 LLM 客户端封装（llm_client.py）

### 4步审核流程
- ① 基础审核（粉绿色）：字数、标题、标签、违禁词检查
- ② 卖点审核（黄紫色）：段落结构、必提词、人话卖点
- ③ 人话修改（蓝色）：AI改写 + 自动清理 + 完整审核表
- ④ 终检（绿色）：全项检查 + 终稿预览

### 一键修复
- 自动替换违禁词（带例外处理）
- 自动补齐缺失标签
- 特殊替换（第一口奶→第一口奶粉）
- 左右对比面板：原稿红色标注 vs 修复后绿色标注

### AI 人话修改
- 集成 Google Gemini 2.0 Flash
- prompt 包含完整违禁词列表+替换规则+必提词
- AI输出后自动跑 auto_fix_all 清理违禁词
- 字数目标设 820-880 留安全余量

### UI/UX
- 4色分区头部（粉绿/黄紫/蓝/绿）
- 侧边栏浅色重设计（去掉深色背景）
- 卖点表格始终展开（不折叠）
- 原稿和修复后都有复制全文功能
- 标题关键词缺失时直接显示编辑框
- 支持 .docx 上传和粘贴文本

### 段落结构检测优化
- 不再按 \n\n 严格分段
- 改为全文搜索锚点关键词，按平均位置判断顺序
- 只要内容包含4个主题且顺序正确即通过

### 修复
- Streamlit 403 AxiosError：关闭 XSRF 保护
- Anthropic SDK 兼容性：升级到 0.79.0
- highlight_revised 只标注第一处：改为标注所有替换处
- API key 问题：从 Anthropic 切换到 Google Gemini
